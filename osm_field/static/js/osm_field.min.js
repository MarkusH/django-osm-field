!function(a){a.fn.osmfield=function(){return this.each(function(){var b=a(this).attr("id"),c=a(this).data("lat-field"),d=a(this).data("lon-field");c=void 0===c?"#"+b+"_lat":"#id_"+c,d=void 0===d?"#"+b+"_lon":"#id_"+d,a(this).addClass("osmfield-input"),a("#"+b+"-map").length||a(this).before('<div class="osmfield-wrapper"><div id="'+b+'-map"></div></div>'),a(this).data("lat-element",a(c)),a(this).data("lng-element",a(d)),a(this).data("map-element",a("#"+b+"-map")),a(this).data("map-element").addClass("osmfield-map");var e=a(this),f=L.map(e.data("map-element")[0]).setView([0,0],15);L.tileLayer("https://otile1-s.mqcdn.com/tiles/1.0.0/map/{z}/{x}/{y}.jpg",{attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery \xa9 <a href="http://www.mapquest.com/">Mapquest</a>',maxZoom:18}).addTo(f);var g=L.marker([0,0],{draggable:!0}).addTo(f),h=e.closest("[lang]").attr("lang");if(h?(h=h.split("-"),h=h[0]):h="en",e.data("language",h),function(b){g.on("dragend",function(c){var d=c.target.getLatLng();f.panTo(d);var e=f.getZoom(),g=b.data("language"),h="https://nominatim.openstreetmap.org/reverse?json_callback=?";b.data("lat-element").val(d.lat),b.data("lng-element").val(d.lng),a.getJSON(h,{format:"json",lat:d.lat,lon:d.lng,zoom:e,addressdetails:0,"accept-language":g},function(a){b.val(a.display_name)})})}(e),e.on("propertychange keyup input paste change",function(){function b(b){var c=b.data("language"),d="https://nominatim.openstreetmap.org/search?json_callback=?";!function(e){a.getJSON(d,{format:"json",q:b.val(),addressdetails:0,"accept-language":c},function(a){if(a.length){var b=a[0].lat,c=a[0].lon;a[0].display_name;e.data("lat-element").val(b),e.data("lng-element").val(c);var h=new L.LatLng(b,c);g.setLatLng(h),f.panTo(h)}else e.data("map-element").slideUp(),e.data("lat-element").val(""),e.data("lng-element").val("");e.is(":focus")&&e.data("lat-element").val()&&e.data("lng-element").val()?e.data("map-element").slideDown(function(){window.dispatchEvent(new Event("resize"))}):e.data("map-element").slideUp()})}(b)}if(a(this).data("oldvalue")!=a(this).val()){a(this).data("oldvalue",a(this).val()),clearTimeout(a.data(this,"timer"));var c=a(this),d=setTimeout(function(){b(c)},500);a(this).data("timer",d)}}),e.data("map-element").hide(),e.data("lat-element").val()&&e.data("lng-element").val()){var i=new L.LatLng(e.data("lat-element").val(),e.data("lng-element").val());g.setLatLng(i),f.panTo(i)}else e.trigger("change");a(document).click(function(b){var c=a(b.target).closest(".osmfield-input, .osmfield-map");c.length?(c.hasClass("osmfield-input")&&(c=c.data("map-element")),a(".osmfield-map").not(c).slideUp()):a(".osmfield-map").slideUp()}),function(a){a.focus(function(){a.data("lat-element").val()&&a.data("lng-element").val()&&a.data("map-element").slideDown(function(){window.dispatchEvent(new Event("resize"))})})}(e)})}}(jQuery);