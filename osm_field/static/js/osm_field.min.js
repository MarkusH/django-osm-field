!function(a){a.fn.osmfield=function(){return this.each(function(){var b,c,d,e,f=a(this).attr("id"),g=a(this).data("lat-field"),h=a(this).data("lon-field"),i=a(this).data("data-field"),j=a(this);if(g=void 0===g?"#"+f+"_lat":"#id_"+g,h=void 0===h?"#"+f+"_lon":"#id_"+h,i=void 0===i?"#"+f+"_data":"#id_"+i,a(this).addClass("osmfield-input"),a("#"+f+"-map").length||a(this).before('<div class="osmfield-wrapper"><div id="'+f+'-map"></div></div>'),a(this).data("lat-element",a(g)),a(this).data("lng-element",a(h)),a(this).data("data-element",a(i)),a(this).data("map-element",a("#"+f+"-map")),a(this).data("map-element").addClass("osmfield-map"),c=L.map(j.data("map-element")[0]).setView([0,0],15),e="http:"===window.location.protocol?"http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}@2x.png":"https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png",L.tileLayer(e,{attribution:"CartoDB | Open Streetmap",maxZoom:18}).addTo(c),d=L.marker([0,0],{draggable:!0}).addTo(c),b=j.closest("[lang]").attr("lang"),b?(b=b.split("-"),b=b[0]):b="en",j.data("language",b),function(b){d.on("dragend",function(d){var e=b.data("language"),f=d.target.getLatLng(),g="https://nominatim.openstreetmap.org/reverse?json_callback=?",h=c.getZoom();c.panTo(f),b.data("lat-element").val(f.lat),b.data("lng-element").val(f.lng),a.getJSON(g,{format:"json",lat:f.lat,lon:f.lng,zoom:h,addressdetails:1,"accept-language":e},function(a){b.val(a.display_name),b.data("data-element").val(JSON.stringify(a))})})}(j),j.on("propertychange keyup input paste change",function(){function b(b){var e=b.data("language"),f="https://nominatim.openstreetmap.org/search?json_callback=?";!function(g){a.getJSON(f,{format:"json",q:b.val(),addressdetails:1,"accept-language":e},function(a){if(a.length){var b=a[0].lat,e=a[0].lon,f=new L.LatLng(b,e),h=JSON.stringify(a[0]);g.data("lat-element").val(b),g.data("lng-element").val(e),g.data("data-element").val(h),d.setLatLng(f),c.panTo(f)}else g.data("map-element").slideUp(),g.data("lat-element").val(""),g.data("lng-element").val(""),g.data("data-element").val("");g.is(":focus")&&g.data("lat-element").val()&&g.data("lng-element").val()?g.data("map-element").slideDown(function(){window.dispatchEvent(new Event("resize"))}):g.data("map-element").slideUp()})}(b)}if(a(this).data("oldvalue")!==a(this).val()){a(this).data("oldvalue",a(this).val()),clearTimeout(a.data(this,"timer"));var e=a(this),f=setTimeout(function(){b(e)},500);a(this).data("timer",f)}}),j.data("map-element").hide(),j.data("lat-element").val()&&j.data("lng-element").val()){var k=new L.LatLng(j.data("lat-element").val(),j.data("lng-element").val());d.setLatLng(k),c.panTo(k)}else j.trigger("change");a(document).click(function(b){var c=a(b.target).closest(".osmfield-input, .osmfield-map");c.length?(c.hasClass("osmfield-input")&&(c=c.data("map-element")),a(".osmfield-map").not(c).slideUp()):a(".osmfield-map").slideUp()}),function(a){a.focus(function(){a.data("lat-element").val()&&a.data("lng-element").val()&&a.data("map-element").slideDown(function(){window.dispatchEvent(new Event("resize"))})})}(j)})}}(jQuery);